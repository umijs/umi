---
order: 5
toc: content
---
# Mock

Umi æä¾›äº†å¼€ç®±å³ç”¨çš„ Mock åŠŸèƒ½ï¼Œèƒ½å¤Ÿç”¨æ–¹ä¾¿ç®€å•çš„æ–¹å¼æ¥å®Œæˆ Mock æ•°æ®çš„è®¾ç½®ã€‚

:::info{title=ğŸ’¡}
ä»€ä¹ˆæ˜¯ Mock æ•°æ®ï¼šåœ¨å‰åç«¯çº¦å®šå¥½ API æ¥å£ä»¥åï¼Œå‰ç«¯å¯ä»¥ä½¿ç”¨ Mock æ•°æ®æ¥åœ¨æœ¬åœ°æ¨¡æ‹Ÿå‡º API åº”è¯¥è¦è¿”å›çš„æ•°æ®ï¼Œè¿™æ ·ä¸€æ¥å‰åç«¯å¼€å‘å°±å¯ä»¥åŒæ—¶è¿›è¡Œï¼Œä¸ä¼šå› ä¸ºåç«¯ API
è¿˜åœ¨å¼€å‘è€Œå¯¼è‡´å‰ç«¯çš„å·¥ä½œè¢«é˜»å¡ã€‚
:::

## ç›®å½•çº¦å®š

Umi çº¦å®š `/mock` ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸º [Mock æ–‡ä»¶](#mock-æ–‡ä»¶)ï¼Œä¾‹å¦‚è¿™æ ·çš„ç›®å½•ç»“æ„ï¼š

```text
.
â”œâ”€â”€ mock
    â”œâ”€â”€ todos.ts
    â”œâ”€â”€ items.ts
    â””â”€â”€ users.ts
â””â”€â”€ src
    â””â”€â”€ pages
        â””â”€â”€ index.tsx
```

åˆ™ `/mock` ç›®å½•ä¸­çš„ `todos.ts`, `items.ts` å’Œ `users.ts` å°±ä¼šè¢« Umi è§†ä¸º [Mock æ–‡ä»¶](#mock-æ–‡ä»¶) æ¥å¤„ç†ã€‚

## Mock æ–‡ä»¶

Mock æ–‡ä»¶é»˜è®¤å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œå¯¹è±¡çš„æ¯ä¸ª Key å¯¹åº”äº†ä¸€ä¸ª Mock æ¥å£ï¼Œå€¼åˆ™æ˜¯è¿™ä¸ªæ¥å£æ‰€å¯¹åº”çš„è¿”å›æ•°æ®ï¼Œä¾‹å¦‚è¿™æ ·çš„ Mock æ–‡ä»¶ï¼š

```ts
// ./mock/users.ts

export default {

  // è¿”å›å€¼å¯ä»¥æ˜¯æ•°ç»„å½¢å¼
  'GET /api/users': [
    { id: 1, name: 'foo' },
    { id: 2, name: 'bar' }
  ],

  // è¿”å›å€¼ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡å½¢å¼
  'GET /api/users/1': { id: 1, name: 'foo' },

}
```

å°±å£°æ˜äº†ä¸¤ä¸ª Mock æ¥å£ï¼Œé€è¿‡ `GET /api/users` å¯ä»¥æ‹¿åˆ°ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªç”¨æˆ·æ•°æ®çš„æ•°ç»„ï¼Œé€è¿‡ `GET /api/users/1` å¯ä»¥æ‹¿åˆ°æŸä¸ªç”¨æˆ·çš„æ¨¡æ‹Ÿæ•°æ®ã€‚

### è¯·æ±‚æ–¹æ³•

å½“ HTTP çš„è¯·æ±‚æ–¹æ³•æ˜¯ GET æ—¶ï¼Œå¯ä»¥çœç•¥æ–¹æ³•éƒ¨åˆ†ï¼Œåªéœ€è¦è·¯å¾„å³å¯ï¼Œä¾‹å¦‚ï¼š

```ts
// ./mock/users.ts

export default {

  '/api/users': [
    { id: 1, name: 'foo' },
    { id: 2, name: 'bar' }
  ],

  '/api/users/1': { id: 1, name: 'foo' },

}
```

ä¹Ÿå¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚æ–¹æ³•ï¼Œä¾‹å¦‚ `POST`ï¼Œ`PUT`ï¼Œ`DELETE`ï¼š

```ts
// ./mock/users.ts

export default {

  'POST /api/users': { result: 'true' },

  'PUT /api/users/1': { id: 1, name: 'new-foo' },

}
```

### è‡ªå®šä¹‰å‡½æ•°

é™¤äº†ç›´æ¥é™æ€å£°æ˜è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥ç”¨å‡½æ•°çš„æ–¹å¼æ¥å£°æ˜å¦‚ä½•è®¡ç®—è¿”å›å€¼ï¼Œä¾‹å¦‚ï¼š

```ts
export default {

  'POST /api/users/create': (req, res) => {
    // æ·»åŠ è·¨åŸŸè¯·æ±‚å¤´
    res.setHeader('Access-Control-Allow-Origin', '*');
    res.end('ok');
  }

}
```

å…³äº `req` å’Œ `res` çš„ API å¯å‚è€ƒ [Express@4 å®˜æ–¹æ–‡æ¡£](https://expressjs.com/en/api.html) æ¥è¿›ä¸€æ­¥äº†è§£ã€‚

### defineMock

å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `defineMock` ç±»å‹å¸®åŠ©å‡½æ•°æ¥æä¾›ç¼–å†™ mock å¯¹è±¡çš„ä»£ç æç¤ºï¼Œå¦‚ï¼š
```ts
import { defineMock } from "umi";

export default defineMock({
  "/api/users": [
    { id: 1, name: "foo" },
    { id: 2, name: "bar" },
  ],
  "/api/users/1": { id: 1, name: "foo" },
  "GET /api/users/2": (req, res) => {
    res.status(200).json({ id: 2, name: "bar" });
  },
});
```
`defineMock` ä»…ä»…æä¾›ç±»å‹æç¤ºï¼Œå…¥å‚ä¸å‡ºå‚å®Œå…¨ä¸€è‡´ã€‚
## å…³é—­ Mock

Umi é»˜è®¤å¼€å¯ Mock åŠŸèƒ½ï¼Œå¦‚æœä¸éœ€è¦çš„è¯å¯ä»¥ä»é…ç½®æ–‡ä»¶å…³é—­ï¼š

```ts
// .umirc.ts

export default {
  mock: false,
};
```

æˆ–æ˜¯ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼å…³é—­ï¼š

```bash
MOCK=none umi dev
```

## å¼•å…¥ Mock.js

åœ¨ Mock ä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ [Mock.js](http://mockjs.com/) æ¥å¸®æˆ‘ä»¬æ–¹ä¾¿åœ°ç”Ÿæˆéšæœºçš„æ¨¡æ‹Ÿæ•°æ®ã€‚å¦‚æœä½ ä½¿ç”¨äº† Umi çš„ Mock
åŠŸèƒ½ï¼Œå»ºè®®ä½ æ­é…è¿™ä¸ªåº“æ¥æå‡æ¨¡æ‹Ÿæ•°æ®çš„çœŸå®æ€§ï¼š

```ts
import mockjs from 'mockjs';

export default {
  // ä½¿ç”¨ mockjs ç­‰ä¸‰æ–¹åº“
  'GET /api/tags': mockjs.mock({
    'list|100': [{ name: '@city', 'value|1-100': 50, 'type|0-2': 1 }],
  }),
};
```

## å…¶ä»–é…ç½®

å…³äº Mock åŠŸèƒ½å®Œæ•´çš„å…¶ä»–é…ç½®é¡¹ï¼Œè¯·åœ¨æ–‡æ¡£çš„ [é…ç½®](../api/config#mock) ç« èŠ‚ä¸­æŸ¥çœ‹ã€‚
